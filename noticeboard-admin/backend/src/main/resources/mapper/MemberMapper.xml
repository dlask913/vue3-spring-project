<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.limnj.noticeboardadmin.member.MemberMapper">
    <!-- 관리자 회원 가입 -->
    <insert id="saveAdminMember" parameterType="AdminMemberRequestDto" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO members (username, password, email, user_type)
        VALUES (#{username}, #{password}, #{email}, 'ADMIN')
    </insert>

    <!-- 관리자 회원 단일 조회 by PK -->
    <select id="findMemberById" parameterType="long" resultType="AdminMemberResponseDto">
        SELECT id, username, password, email
        FROM members
        WHERE id = #{id} AND user_type = 'ADMIN'
    </select>

    <!-- 관리자 회원 단일 조회 by Username -->
    <select id="findMemberByUsername" parameterType="String" resultType="AdminMemberResponseDto">
        SELECT id, username, password, email
        FROM members
        WHERE username = #{username} AND user_type = 'ADMIN'
    </select>

    <!-- 특정 이메일을 갖는 회원 존재 여부 확인 -->
    <select id="existsByEmail" parameterType="String" resultType="boolean">
        SELECT EXISTS (
            SELECT 1
            FROM members
            WHERE email = #{email} AND user_type = 'ADMIN'
        )
    </select>

    <!-- 회원 2FA QR secretKey 저장 -->
    <update id ="updateSecretKeyByEmail">
        UPDATE members
        SET secret_key = #{secretKey}, updated_at = NOW()
        WHERE email = #{email} AND user_type = 'ADMIN'
    </update>

    <!-- 회원 2FA QR secretKey 조회 -->
    <select id="findSecretKeyByEmail" parameterType="String" resultType="String">
        SELECT secret_key
        FROM members
        WHERE email = #{email} AND user_type = 'ADMIN'
    </select>
</mapper>