groups:
  - name: spring-boot-alerts
    rules:

      # 서버 다운 알림
      - alert: SpringBootInstanceDown
        expr: up{job="spring-actuator"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Spring Boot 서버 다운"
          description: "Spring Boot 인스턴스가 30초 이상 응답하지 않습니다."

      # 응답시간 지연
      - alert: HighLatency
        expr: histogram_quantile(0.90, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 1.5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "API 응답시간 지연"
          description: "90% 요청의 응답시간이 1.5초를 넘습니다."
      
      # 메모리 부족
      - alert: HighMemoryUsage
        expr: sum(jvm_memory_used_bytes{area="heap"}) / sum(jvm_memory_max_bytes{area="heap"}) > 0.9
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "메모리 사용량 과다"
          description: "JVM 메모리 사용량이 90%를 초과했습니다."

      # CPU 사용량 증가
      - alert: HighCpuUsage
        expr: process_cpu_usage > 0.8
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "CPU 사용량 높음"
          description: "CPU 사용량이 80% 이상입니다."